# 松耦合与可测试设计 Loosely-coupled And Testable Designs
本篇记录了松耦合与可测试设计之间的关系

### 松耦合设计与测试的关系是什么？
只有松耦合结构的代码才具备可测试性。在实际情况中，项目可能继承大量多年前的代码，这些代码在编写的过程中可能没有考虑到会进行单元测试，导致无法对其进行单元测试。如果想单元测试这些"遗产代码"，就需要将这些代码重构，使其具备可测试性。

### 为什么只有松耦合结构的代码才可测试？
紧耦合代码不符合单元测试的基本条件，即单元测试对象必须为隔离状态，不能与外部资源有联系。遇到必须与外部资源有联系的方法，紧耦合结构就直接丧失可测试性。而松耦合结构代码可以通过在运行时将外部资源对象替换成一个空壳对象，达到不真正与外部资源联系的目的，从而具备可测试性。这种空壳对象被称为**假对象(Fake Object)或测试替身(Test Double)**。

### 如何才能将远古代码重构成符合松耦合设计标准并具备可测试性？
只需跟随简单三步走:

1. 将涉及到与外部资源沟通的代码部分抽取出来，放在一个新建的单独类中，达到将受测类/方法隔离的目的
2. 从刚新建的单独类中抽取一个接口并让这个类执行这个接口
3. 将这个接口注入到原受测类中

以上，即可将遗产代码重构为松耦合结构并具备可测试性。

### 如何将接口注入到原受测类中？
有三种注入方式:

* 通过方法参数注入
* 通过类中属性注入
* 通过类中构造器注入

通过以上任意方式注入接口到受测类/方法中，可以达到解耦的目的，即将依赖关系从紧密依赖某一具体类改成依赖所有执行了某一接口的类，因此这种注入方式也称为**依赖注入**。
